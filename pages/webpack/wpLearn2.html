<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高级用法 | Mich&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.4.1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.2/jquery.fancybox.min.css">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="The road to the strong">
    <link rel="preload" href="/assets/css/0.styles.4b854bb7.css" as="style"><link rel="preload" href="/assets/js/app.f643973a.js" as="script"><link rel="preload" href="/assets/js/2.753c10ed.js" as="script"><link rel="preload" href="/assets/js/33.535de53e.js" as="script"><link rel="prefetch" href="/assets/js/10.3d930c67.js"><link rel="prefetch" href="/assets/js/11.6cbbc78a.js"><link rel="prefetch" href="/assets/js/12.01fe6ecf.js"><link rel="prefetch" href="/assets/js/13.99e5bd5e.js"><link rel="prefetch" href="/assets/js/14.1d141b2f.js"><link rel="prefetch" href="/assets/js/15.92115d58.js"><link rel="prefetch" href="/assets/js/16.fcee34cd.js"><link rel="prefetch" href="/assets/js/17.83f32e63.js"><link rel="prefetch" href="/assets/js/18.cbc65afa.js"><link rel="prefetch" href="/assets/js/19.d6b7025a.js"><link rel="prefetch" href="/assets/js/20.08e3bc90.js"><link rel="prefetch" href="/assets/js/21.ff60c0e7.js"><link rel="prefetch" href="/assets/js/22.5f62aef6.js"><link rel="prefetch" href="/assets/js/23.35e2b7bd.js"><link rel="prefetch" href="/assets/js/24.646ed6ac.js"><link rel="prefetch" href="/assets/js/25.1e5ec134.js"><link rel="prefetch" href="/assets/js/26.1c46b0bd.js"><link rel="prefetch" href="/assets/js/27.30091fa6.js"><link rel="prefetch" href="/assets/js/28.ddc90f7c.js"><link rel="prefetch" href="/assets/js/29.1203a81e.js"><link rel="prefetch" href="/assets/js/3.4052bb85.js"><link rel="prefetch" href="/assets/js/30.c358a7b5.js"><link rel="prefetch" href="/assets/js/31.37a71f09.js"><link rel="prefetch" href="/assets/js/32.4926c8f4.js"><link rel="prefetch" href="/assets/js/34.79922f2e.js"><link rel="prefetch" href="/assets/js/35.ad61e7de.js"><link rel="prefetch" href="/assets/js/36.b8b2ba65.js"><link rel="prefetch" href="/assets/js/4.f04d084c.js"><link rel="prefetch" href="/assets/js/5.6261e066.js"><link rel="prefetch" href="/assets/js/6.0a7a309b.js"><link rel="prefetch" href="/assets/js/7.4e3bd12c.js"><link rel="prefetch" href="/assets/js/8.d79e2cde.js"><link rel="prefetch" href="/assets/js/9.c19feabc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4b854bb7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="Mich's Blog" class="logo"> <span class="site-name can-hide">Mich's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><span class="title">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/rtLearn2.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/pages/vue/vLearn1.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/pages/redux/rdLearn.html" class="nav-link">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/pages/reactNative/means/rnMeans1.html" class="nav-link">
  React-Native
</a></li><li class="dropdown-item"><!----> <a href="/pages/taro/learn/trLearn1.html" class="nav-link">
  Taro
</a></li><li class="dropdown-item"><!----> <a href="/pages/css/learn/cssLearn1.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/pages/javaScript/jsLearn2.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/pages/typeScript/learn/tsLearn1.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/pages/egret/means/egMeans1.html" class="nav-link">
  Egret游戏开发
</a></li><li class="dropdown-item"><!----> <a href="/pages/python/demo/crawler1.html" class="nav-link">
  Python爬虫
</a></li><li class="dropdown-item"><!----> <a href="/pages/webpack/wpLearn1.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/pages/node/ndLearn1.html" class="nav-link">
  Node.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="摄影" class="dropdown-title"><span class="title">爱好</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/shoot/imgShow191001.html" class="nav-link">
  摄影
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="上线作品" class="dropdown-title"><span class="title">上线作品</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.4399.com/flash/208072.htm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  商人奇遇记
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.4399.com/flash/209642.htm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  就爱来找茬
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.4399.com/flash/210824.htm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  垃圾分类大挑战
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/KoWhite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><span class="title">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/react/rtLearn2.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/pages/vue/vLearn1.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/pages/redux/rdLearn.html" class="nav-link">
  Redux
</a></li><li class="dropdown-item"><!----> <a href="/pages/reactNative/means/rnMeans1.html" class="nav-link">
  React-Native
</a></li><li class="dropdown-item"><!----> <a href="/pages/taro/learn/trLearn1.html" class="nav-link">
  Taro
</a></li><li class="dropdown-item"><!----> <a href="/pages/css/learn/cssLearn1.html" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/pages/javaScript/jsLearn2.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/pages/typeScript/learn/tsLearn1.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/pages/egret/means/egMeans1.html" class="nav-link">
  Egret游戏开发
</a></li><li class="dropdown-item"><!----> <a href="/pages/python/demo/crawler1.html" class="nav-link">
  Python爬虫
</a></li><li class="dropdown-item"><!----> <a href="/pages/webpack/wpLearn1.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-item"><!----> <a href="/pages/node/ndLearn1.html" class="nav-link">
  Node.js
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="摄影" class="dropdown-title"><span class="title">爱好</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/shoot/imgShow191001.html" class="nav-link">
  摄影
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="上线作品" class="dropdown-title"><span class="title">上线作品</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.4399.com/flash/208072.htm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  商人奇遇记
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.4399.com/flash/209642.htm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  就爱来找茬
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.4399.com/flash/210824.htm" target="_blank" rel="noopener noreferrer" class="nav-link external">
  垃圾分类大挑战
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://github.com/KoWhite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>react-native</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>taro</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>egret游戏开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python爬虫</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/webpack/wpLearn1.html" class="sidebar-link">webpack入门</a></li><li><a href="/pages/webpack/wpLearn2.html" class="active sidebar-link">webpack高级用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#自动清理构建目录" class="sidebar-link">自动清理构建目录</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#使用postcss插件autoprefixer自动补齐css3前缀（后置处理）" class="sidebar-link">使用PostCSS插件autoprefixer自动补齐CSS3前缀（后置处理）</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#通过webpack进行px转化为rem" class="sidebar-link">通过webpack进行px转化为rem</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#静态资源内联" class="sidebar-link">静态资源内联</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#多页面打包方案" class="sidebar-link">多页面打包方案</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#使用sourcemap" class="sidebar-link">使用sourcemap</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#提取页面公共资源" class="sidebar-link">提取页面公共资源</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#tree-shaking-摇树优化" class="sidebar-link">tree shaking (摇树优化)</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#scope-hoisting使用和原理分析" class="sidebar-link">Scope Hoisting使用和原理分析</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#代码分割和动态import" class="sidebar-link">代码分割和动态import</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#webpack使用eslint" class="sidebar-link">webpack使用ESLint</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#webpack-打包组件或者基础库" class="sidebar-link">webpack 打包组件或者基础库</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#webpack实现ssr打包" class="sidebar-link">webpack实现SSR打包</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#优化构建时命令行显示日志" class="sidebar-link">优化构建时命令行显示日志</a></li><li class="sidebar-sub-header"><a href="/pages/webpack/wpLearn2.html#在webpack中进行错误捕获及异常处理" class="sidebar-link">在webpack中进行错误捕获及异常处理</a></li></ul></li><li><a href="/pages/webpack/wpLearn3.html" class="sidebar-link">webpack构建配置</a></li><li><a href="/pages/webpack/wpLearn4.html" class="sidebar-link">webpack构建速度及体积优化</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="高级用法"><a href="#高级用法" class="header-anchor">#</a> 高级用法</h1> <h2 id="自动清理构建目录"><a href="#自动清理构建目录" class="header-anchor">#</a> 自动清理构建目录</h2> <h3 id="_1、通过npm-script清理构建目录（不够优雅）"><a href="#_1、通过npm-script清理构建目录（不够优雅）" class="header-anchor">#</a> 1、通过npm script清理构建目录（不够优雅）</h3> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>rm <span class="token operator">-</span>rf <span class="token punctuation">.</span><span class="token operator">/</span>dist <span class="token operator">&amp;&amp;</span> webpack
rimraf <span class="token punctuation">.</span><span class="token operator">/</span>dist <span class="token operator">&amp;&amp;</span> webpack
</code></pre></div><h3 id="_2、借助clean-webpack-plugin-（默认会删除output指定的输出目录）"><a href="#_2、借助clean-webpack-plugin-（默认会删除output指定的输出目录）" class="header-anchor">#</a> 2、借助clean-webpack-plugin （默认会删除output指定的输出目录）</h3> <p>（1）安装</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>npm i clean<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>or</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>yarn add clean<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>（2）使用这个插件
首先在webpack配置文件引入这个插件：</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> CleanWebpackPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后在plugins中：</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="使用postcss插件autoprefixer自动补齐css3前缀（后置处理）"><a href="#使用postcss插件autoprefixer自动补齐css3前缀（后置处理）" class="header-anchor">#</a> 使用PostCSS插件autoprefixer自动补齐CSS3前缀（后置处理）</h2> <p>根据 can i use (https://caniuse.com/)规则
（1）安装</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>npm i postcss<span class="token operator">-</span>loader autoprefixer <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>or</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>yarn add postcss<span class="token operator">-</span>loader autoprefixer <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><h2 id="通过webpack进行px转化为rem"><a href="#通过webpack进行px转化为rem" class="header-anchor">#</a> 通过webpack进行px转化为rem</h2> <p>（1）安装</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>npm i px2rem<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
npm i lib<span class="token operator">-</span>flexible <span class="token operator">-</span><span class="token constant">S</span>
</code></pre></div><p>or</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>yarn add px2rem<span class="token operator">-</span>loader <span class="token operator">-</span><span class="token constant">D</span>
yarn add lib<span class="token operator">-</span>flexible <span class="token operator">-</span><span class="token constant">S</span>
</code></pre></div><h2 id="静态资源内联"><a href="#静态资源内联" class="header-anchor">#</a> 静态资源内联</h2> <h2 id="多页面打包方案"><a href="#多页面打包方案" class="header-anchor">#</a> 多页面打包方案</h2> <div class="custom-block tip"><p class="custom-block-title">思路</p> <p>每个页面对应一个entry，一个html-webpack-plugin
手动添加灵活性差，可以利用glob.sync
entry: glob.sync(path.join(__dirname, './src/*/index.js'))</p></div> <p>（1）安装Glob</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>npm i glob <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>or</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>yarn add glob <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>（2）使用
首先需要明白，glob.sync可以帮助我们获取到所有src文件夹下面的index.js入口，我们根据这个功能来展开</p> <p>引入glob</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'glob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后我们可以写一个函数以动态的创建入口和出口</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">setMPA</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 存储输入</span>
    <span class="token keyword">const</span> HtmlWebpackPlugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 存储对应插件配置</span>

    <span class="token keyword">const</span> entryFiles <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/*/index.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 获取所有文件夹下的index.js路径</span>

    entryFiles<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> entryFile <span class="token operator">=</span> item<span class="token punctuation">;</span>
        <span class="token keyword">const</span> match <span class="token operator">=</span> entryFile<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/src\/(.*)\/index\.js/</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> 通过正则表达式
        <span class="token keyword">const</span> pageName <span class="token operator">=</span> match <span class="token operator">&amp;&amp;</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> 获取index<span class="token punctuation">.</span>js父文件夹的名称

        entry<span class="token punctuation">[</span>pageName<span class="token punctuation">]</span> <span class="token operator">=</span> entryFile<span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> 创建输入
        HtmlWebpackPlugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
                template<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">src/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pageName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index.html</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                filename<span class="token operator">:</span> `$<span class="token punctuation">{</span>pageName<span class="token punctuation">}</span><span class="token punctuation">.</span>html`<span class="token punctuation">,</span>
                chunks<span class="token operator">:</span> <span class="token punctuation">[</span>pageName<span class="token punctuation">]</span><span class="token punctuation">,</span>
                inject<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                minify<span class="token operator">:</span> <span class="token punctuation">{</span>
                    html5<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    collapseWhitespace<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    preserveLineBreaks<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                    minifyCSS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    minifyJS<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    removeComments<span class="token operator">:</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">/</span><span class="token operator">/</span> 以数组的形式存储输出口
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        entry<span class="token punctuation">,</span>
        HtmlWebpackPlugins
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定义好函数之后，我们将对应数据配置</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> entry<span class="token punctuation">,</span> HtmlWebpackPlugins <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">setMPA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">,</span> <span class="token comment">// 入口数据</span>
    output<span class="token operator">:</span> <span class="token punctuation">{</span>
        path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        filename<span class="token operator">:</span> <span class="token string">'[name]_[chunkhash:8].js'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span>
    plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            filename<span class="token operator">:</span> <span class="token string">'[name]_[contenthash:8].css'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
            assetNameRegExp<span class="token operator">:</span> <span class="token regex">/\.css$/g</span><span class="token punctuation">,</span>
            cssProcessor<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cssnano'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>HtmlWebpackPlugins<span class="token punctuation">)</span> <span class="token comment">// 连接两个数组</span>
</code></pre></div><p>以上便是当多页面情况的处理方式，灵活性高，后期可以根据项目任意修改</p> <h2 id="使用sourcemap"><a href="#使用sourcemap" class="header-anchor">#</a> 使用sourcemap</h2> <div class="custom-block tip"><p class="custom-block-title">功能</p> <p><a href="http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html" target="_blank" rel="noopener noreferrer">http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
开发环境开启，线上环境关闭（容易暴露业务逻辑）
线上排查问题的时候可将sourcemap上传到错误监控系统</p></div> <p>（1）关键字
eval: 使用eval包裹模块代码</p> <p>source map: 产生.map文件</p> <p>cheap: 不包含列信息</p> <p>inline: 将.map作为DataURI嵌入，不单独生成.map文件</p> <p>module: 包含loader的sourcemap</p> <p>（2）具体功能细化
<a href="https://segmentfault.com/a/1190000016404266?utm_source=tag-newest" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000016404266?utm_source=tag-newest<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="提取页面公共资源"><a href="#提取页面公共资源" class="header-anchor">#</a> 提取页面公共资源</h2> <h3 id="基础库分离（以react为例）"><a href="#基础库分离（以react为例）" class="header-anchor">#</a> 基础库分离（以react为例）</h3> <p>（1）通过html-webpack-externals-plugin</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>思路：将react、react-dom 基础包通过cdn引入，不打入bundle中
方法：使用html-webpack-externals-plugin</p></div> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> HtmlWebpackExternalsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-externals-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

plugin<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackExternalsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        externals<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                module<span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
                entry<span class="token operator">:</span> <span class="token string">'https://unpkg.com/react@16/umd/react.development.js'</span><span class="token punctuation">,</span>
                global<span class="token operator">:</span> <span class="token string">'React'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
                module<span class="token operator">:</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
                entry<span class="token operator">:</span> <span class="token string">'https://unpkg.com/react-dom@16/umd/react-dom.development.js'</span><span class="token punctuation">,</span>
                global<span class="token operator">:</span> <span class="token string">'ReactDOM'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><p>（1）利用SplitChunksPlugin 进行公共脚本分离
webpack4内置的，替代CommonsChunkPlugin插件</p> <p>chunks 参数说明：</p> <ol><li><p>async异步引入的库进行分离</p></li> <li><p>inital 同步引入的库进行分离</p></li> <li><p>all 所有引入的库进行分离</p></li></ol> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
        minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 分离的包体积大小</span>
        cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span>
            commons<span class="token operator">:</span> <span class="token punctuation">{</span>
                test<span class="token operator">:</span> <span class="token regex">/(react|react-dom)/</span><span class="token punctuation">,</span> <span class="token comment">// 匹配出需要分离的包</span>
                name<span class="token operator">:</span> <span class="token string">'vendonrs'</span><span class="token punctuation">,</span> 
                chunks<span class="token operator">:</span> <span class="token string">'all'</span><span class="token punctuation">,</span>
                minChunls<span class="token operator">:</span> <span class="token number">2</span> <span class="token comment">// 设置最小的引用次数为2次</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="tree-shaking-摇树优化"><a href="#tree-shaking-摇树优化" class="header-anchor">#</a> tree shaking (摇树优化)</h2> <div class="custom-block tip"><p class="custom-block-title">概念</p> <p>一模块可能有多个方法，只要其中的某个方法使用到，则整个文件都会被打到bundle里，tree shaking就是只把用到的方法打到bundle，没用到的方法会在uglify阶段被擦除掉</p></div> <div class="custom-block tip"><p class="custom-block-title">使用</p> <p>webpack 默认支持，在.babelrc里设置 modules: false 即可</p></div> <div class="custom-block tip"><p class="custom-block-title">要求</p> <p>必须是ES6的语法，CJS的方式不支持</p></div> <div class="custom-block tip"><p class="custom-block-title">原理</p> <p>利用ES6模块的特点：</p> <ol><li>只能作为模块顶层的语句出现</li> <li>import的模块名只能是字符串常量</li> <li>import binding 是immutable的</li></ol> <p>ES6模块依赖关系是确定的，和运行时的状态无关，可以进行可靠的静态分析（不执行代码，从字面量上对代码进行分析，ES6之前的模块化，比如我们可以动态require一个模块，只有执行后才知道引用的什么模块，这就不能通过静态分析去优化）</p> <p>代码擦除： uglify阶段删除无用代码</p></div> <h2 id="scope-hoisting使用和原理分析"><a href="#scope-hoisting使用和原理分析" class="header-anchor">#</a> Scope Hoisting使用和原理分析</h2> <div class="custom-block warning"><p class="custom-block-title">引入</p> <p>没有开启Scope Hoisting时会出现有大量闭包函数的代码；
大量函数闭包包裹代码，导致体积增大（模块越多越明显）
运行代码时创建的函数作用域变多，内存开销变大</p> <p>结论： 被webpack转换后的模块会带上一层包裹，import会被转换成_webpack_require</p></div> <div class="custom-block tip"><p class="custom-block-title">原理</p> <p>将所有模块的代码按照引用顺序放在一个函数作用域里，然后适当的重命名一些变量以防止变量名冲突</p></div> <div class="custom-block tip"><p class="custom-block-title">优势</p> <p>通过scope hoisting 可以减少函数声明代码和内存开销</p></div> <div class="custom-block tip"><p class="custom-block-title">使用</p> <p>webpack mode 为 production 默认开启
必须是ES6语法</p></div> <h2 id="代码分割和动态import"><a href="#代码分割和动态import" class="header-anchor">#</a> 代码分割和动态import</h2> <div class="custom-block tip"><p class="custom-block-title">懒加载JS方式</p> <p>CommonJS: require.ensure
ES6: 动态import（目前没有原生支持，需要Babel转换）</p></div> <h3 id="动态import使用方法"><a href="#动态import使用方法" class="header-anchor">#</a> 动态import使用方法</h3> <p>1、安装</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>npm i @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>syntax<span class="token operator">-</span>dynamic<span class="token operator">-</span><span class="token keyword">import</span> <span class="token operator">--</span>sava<span class="token operator">-</span>dev
</code></pre></div><p>or</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>yarn add @babel<span class="token operator">/</span>plugin<span class="token operator">-</span>syntax<span class="token operator">-</span>dynamic<span class="token operator">-</span><span class="token keyword">import</span> <span class="token operator">--</span>sava<span class="token operator">-</span>dev
</code></pre></div><p>2、ES6: 动态import
借助babel，在.babelrc中添加以下插件</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;plugin&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="webpack使用eslint"><a href="#webpack使用eslint" class="header-anchor">#</a> webpack使用ESLint</h2> <div class="custom-block tip"><p class="custom-block-title">意义</p> <p>对代码进行规范检查，避免语法错误</p></div> <h3 id="方案一：eslint与ci-cd集成"><a href="#方案一：eslint与ci-cd集成" class="header-anchor">#</a> 方案一：ESLint与CI/CD集成</h3> <h3 id="方案二：webpack与eslint集成-https-eslint-bootcss-com"><a href="#方案二：webpack与eslint集成-https-eslint-bootcss-com" class="header-anchor">#</a> 方案二：webpack与ESLint集成(<a href="https://eslint.bootcss.com/" target="_blank" rel="noopener noreferrer">https://eslint.bootcss.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)</h3> <p><a href="https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb" target="_blank" rel="noopener noreferrer">https://github.com/airbnb/javascript/tree/master/packages/eslint-config-airbnb<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="webpack-打包组件或者基础库"><a href="#webpack-打包组件或者基础库" class="header-anchor">#</a> webpack 打包组件或者基础库</h2> <p>webpack除了可以用来打包应用，也可以用来打包js库</p> <h2 id="webpack实现ssr打包"><a href="#webpack实现ssr打包" class="header-anchor">#</a> webpack实现SSR打包</h2> <div class="custom-block tip"><p class="custom-block-title">服务端渲染（SSR）是什么</p> <p>渲染：HTML+CSS+JS+DATA -&gt; 渲染后的HTML</p> <p>服务端：
所有模板等资源都存储在服务端
内网机器拉取数据更快
一个HTML返回所有数据</p></div> <h3 id="客户端渲染（csr）和服务端渲染（ssr）比对"><a href="#客户端渲染（csr）和服务端渲染（ssr）比对" class="header-anchor">#</a> 客户端渲染（CSR）和服务端渲染（SSR）比对</h3> <p><a data-fancybox="" title="CSR\SSR" href="https://img-blog.csdnimg.cn/20200417111127675.png"><img src="https://img-blog.csdnimg.cn/20200417111127675.png" alt="CSR\SSR"></a></p> <p><a data-fancybox="" title="CSR\SSR" href="https://img-blog.csdnimg.cn/20200417111343821.png"><img src="https://img-blog.csdnimg.cn/20200417111343821.png" alt="CSR\SSR"></a></p> <h3 id="ssr代码实现思路"><a href="#ssr代码实现思路" class="header-anchor">#</a> SSR代码实现思路</h3> <p>（1）服务端
使用 react-dom/server 的 renderToString 方法将React组件渲染成字符串</p> <p>服务端路由返回对应的模板</p> <p>（2）客户端
打包出针对服务端的组件</p> <h3 id="搭建ssr"><a href="#搭建ssr" class="header-anchor">#</a> 搭建SSR</h3> <p>1、创建服务端环境
在当前项目中创建server文件夹，接下来将用express帮助搭建服务端环境
安装express</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>npm i express <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>在server中创建index.js入口文件</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    global<span class="token punctuation">.</span>window <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SSR</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dist/search-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">server</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">server</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">port</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderMarkup</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token constant">SSR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 链接监听</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port:'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个HTML模板</span>
<span class="token keyword">const</span> <span class="token function-variable function">renderMarkup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        &lt;!DOCTYPE html&gt;
        &lt;html lang=&quot;en&quot;&gt;
        &lt;head&gt;
            &lt;meta charset=&quot;UTF-8&quot;&gt;
            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
            &lt;title&gt;Document&lt;/title&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;div className=&quot;root&quot;&gt;
                </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
            &lt;/div&gt;
        &lt;/body&gt;
        &lt;/html&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2、创建一个ssr打包
首先创建一个打包文件,注意js的命名不再需要hash，然后在npm Script配置，假设我这里创建名字叫webpack.ssr.js
而后我们在npm Script中配置<code>&quot;build:ssr&quot;: &quot;webpack --config webpack.ssr.js&quot;</code>以创建一个打包命令</p> <h3 id="webpack-ssr-打包存在的问题"><a href="#webpack-ssr-打包存在的问题" class="header-anchor">#</a> webpack ssr 打包存在的问题</h3> <ol><li><p>浏览器的全局变量（Node.js中没有document，window）
组件适配：将不兼容的组件根据打包环境进行适配
请求适配：将fetch或者ajax发送请求的写法改成isomorphic-fetch 或者 axios</p></li> <li><p>样式问题（Node.js 无法解析 css)
方案一：服务端打包通过ignore-loader忽略掉css的解析
方案二：将 style-loader 替换成 isomorphic-style-loader</p></li></ol> <h3 id="如何解决样式不显示的问题"><a href="#如何解决样式不显示的问题" class="header-anchor">#</a> 如何解决样式不显示的问题</h3> <p>使用打包出来的浏览器端html为模板
设置占位符，动态插入组件</p> <p>针对样式不显示的情况我们接下来修改server下面的index.js</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    global<span class="token punctuation">.</span>window <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SSR</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dist/search-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/search.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">server</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">port</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderMarkup</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token constant">SSR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 链接监听</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port:'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">server</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个HTML模板</span>
<span class="token keyword">const</span> <span class="token function-variable function">renderMarkup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'&lt;!--HTML_PLACEHOLDER--&gt;'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后修改我们的serch.html</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--HTML_PLACEHOLDER--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>针对数据的情况，我们同样也可以通过占位符的方式来处理</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--HTML_PLACEHOLDER--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--INITIAL_DATA_PLACEHOLDER--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>修改server/index.js</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    global<span class="token punctuation">.</span>window <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'react-dom/server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">SSR</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../dist/search-server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> template <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/search.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../data.json'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">server</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">port</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/search'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> html <span class="token operator">=</span> <span class="token function">renderMarkup</span><span class="token punctuation">(</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token constant">SSR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 链接监听</span>
    app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port:'</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">server</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个HTML模板</span>
<span class="token keyword">const</span> <span class="token function-variable function">renderMarkup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dataStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> template<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'&lt;!--HTML_PLACEHOLDER--&gt;'</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'&lt;!--INITIAL_DATA_PLACEHOLDER--&gt;'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script&gt;window.__initial_data=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dataStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/script&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="优化构建时命令行显示日志"><a href="#优化构建时命令行显示日志" class="header-anchor">#</a> 优化构建时命令行显示日志</h2> <div class="custom-block tip"><p class="custom-block-title">需求</p> <p>构建时展示的一大堆日志，很多并不需要开发者关注</p></div> <p>通过设置stats来优化，开发阶段放在devServer，生产阶段放在module.exports中。
设置的属性参考<a href="https://www.webpackjs.com/configuration/stats/" target="_blank" rel="noopener noreferrer">https://www.webpackjs.com/configuration/stats/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>除了设置stats的方式，还可以通过<code>friendly-errors-webpack-plugin</code>,并且设置<code>stats: errors-only</code></p> <p>1、安装</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>npm i friendly<span class="token operator">-</span>errors<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>or</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code>yarn add friendly<span class="token operator">-</span>errors<span class="token operator">-</span>webpack<span class="token operator">-</span>plugin <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>2、使用
在生产环境和开发环境中引入对应插件即可：</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> FriendlyErrorsWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'friendly-errors-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token operator">...</span>
    <span class="token keyword">new</span> <span class="token class-name">FriendlyErrorsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">]</span>
</code></pre></div><h2 id="在webpack中进行错误捕获及异常处理"><a href="#在webpack中进行错误捕获及异常处理" class="header-anchor">#</a> 在webpack中进行错误捕获及异常处理</h2> <div class="custom-block tip"><p class="custom-block-title">需求</p> <p>在 CI/CD 的 pipline 或者发布系统需要知道当前构建状态</p> <p>每次构建完成后输入 echo $? 获取错误码</p></div> <div class="custom-block danger"><p class="custom-block-title">注意</p> <p>webpack4 之前版本构建失败不会抛出错误码（error code）</p> <p>Node.js 中的 process.exit 规范
0 表示成功完成，回掉函数中，err为null
非 0 表示执行失败，回掉函数中，err不为null，err.code 就是传给 exit 的数字</p></div> <div class="custom-block tip"><p class="custom-block-title">如何捕获</p> <p>compiler 在每次构建结束后会触发 done 这个 hook
process.exit 主动处理构建报错</p></div> <p>通过在plugins中增加这段</p> <div class="language-javaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span>errors <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'--watch'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'build error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">4/27/2020, 12:01:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/webpack/wpLearn1.html" class="prev">
        webpack入门
      </a></span> <span class="next"><a href="/pages/webpack/wpLearn3.html">
        webpack构建配置
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f643973a.js" defer></script><script src="/assets/js/2.753c10ed.js" defer></script><script src="/assets/js/33.535de53e.js" defer></script>
  </body>
</html>
